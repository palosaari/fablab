
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.4.0">
    
    
      
        <title>8. Input devices - Fab Lab Oulu Student Blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.69437709.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#8-input-devices" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Fab Lab Oulu Student Blog" class="md-header__button md-logo" aria-label="Fab Lab Oulu Student Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Fab Lab Oulu Student Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              8. Input devices
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Fab Lab Oulu Student Blog" class="md-nav__button md-logo" aria-label="Fab Lab Oulu Student Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Fab Lab Oulu Student Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        About Me
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../finalproject/" class="md-nav__link">
        Final Project
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Assignments
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Assignments" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Assignments
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../week01/" class="md-nav__link">
        1. Principles and practices
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../week02/" class="md-nav__link">
        2. Project management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../week03/" class="md-nav__link">
        3. Computer-Aided Design
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../week04/" class="md-nav__link">
        4. Computer controlled cutting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../week05/" class="md-nav__link">
        5. Invention, intellectual property and income
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../week06/" class="md-nav__link">
        6. Electronics production
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../week07/" class="md-nav__link">
        7. Electronics design
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          8. Input devices
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        8. Input devices
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#assignment" class="md-nav__link">
    Assignment
  </a>
  
    <nav class="md-nav" aria-label="Assignment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#individual-assignment" class="md-nav__link">
    Individual assignment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-assignment" class="md-nav__link">
    Group assignment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new-week-new-board-esp32" class="md-nav__link">
    New week, new board - ESP32
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#circuit-board-assembly" class="md-nav__link">
    Circuit board assembly
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#circuit-board-testing" class="md-nav__link">
    Circuit board testing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#temperature-sensors" class="md-nav__link">
    Temperature sensors
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oscilloscope-exercise" class="md-nav__link">
    Oscilloscope exercise
  </a>
  
    <nav class="md-nav" aria-label="Oscilloscope exercise">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ntc-thermistor-circuit" class="md-nav__link">
    NTC thermistor circuit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dht11-sensor" class="md-nav__link">
    DHT11 sensor
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#files" class="md-nav__link">
    Files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#final-thoughts" class="md-nav__link">
    Final thoughts
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../week09/" class="md-nav__link">
        9. Output devices
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../week10/" class="md-nav__link">
        10. Embedded programming
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../week11/" class="md-nav__link">
        11. Interface and application programming
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../week12/" class="md-nav__link">
        12. Applications and implications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../week13/" class="md-nav__link">
        13. Networking and communications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../week14/" class="md-nav__link">
        14. 3D Scanning and Printing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../week15/" class="md-nav__link">
        15. Molding and Casting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../week16/" class="md-nav__link">
        16. Computer Controlled Machining
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../week18/" class="md-nav__link">
        18. Mechanical Design (part 1 of 2)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../week19/" class="md-nav__link">
        19. Machine Design (part 2 of 2)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#assignment" class="md-nav__link">
    Assignment
  </a>
  
    <nav class="md-nav" aria-label="Assignment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#individual-assignment" class="md-nav__link">
    Individual assignment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-assignment" class="md-nav__link">
    Group assignment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new-week-new-board-esp32" class="md-nav__link">
    New week, new board - ESP32
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#circuit-board-assembly" class="md-nav__link">
    Circuit board assembly
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#circuit-board-testing" class="md-nav__link">
    Circuit board testing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#temperature-sensors" class="md-nav__link">
    Temperature sensors
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oscilloscope-exercise" class="md-nav__link">
    Oscilloscope exercise
  </a>
  
    <nav class="md-nav" aria-label="Oscilloscope exercise">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ntc-thermistor-circuit" class="md-nav__link">
    NTC thermistor circuit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dht11-sensor" class="md-nav__link">
    DHT11 sensor
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#files" class="md-nav__link">
    Files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#final-thoughts" class="md-nav__link">
    Final thoughts
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="8-input-devices">8. Input devices</h1>
<blockquote>
<h2 id="assignment">Assignment</h2>
<h3 id="individual-assignment">Individual assignment</h3>
<ul>
<li>Measure something: add a sensor to a microcontroller board that you have designed and read it</li>
</ul>
<h3 id="group-assignment">Group assignment</h3>
<ul>
<li>Probe an input device's analog levels and digital signals</li>
</ul>
</blockquote>
<h2 id="new-week-new-board-esp32">New week, new board - ESP32</h2>
<p>I decided to make a new circuit board with lots of I/O pins for this week. The intention is that I will cope with a new board throughout this course serie. I have been thinking of using the <a href="https://www.espressif.com/en/products/socs/esp32">Espressif ESP32</a> chip for the final project so I chose it as the microcontroller for the new board. Thus, I am already gaining experience with that microcontroller at the same. </p>
<p>I designed the schematic and the PCB like in previous exercises with KiCad. I wanted to make the board as compact as possible, using surface mount technology and a single sided PCB. This posed some challenges, among other things, to the widths and clearances of the tracks used, which had to be made quite narrow. Another factor influencing the size of the tracks is the circuit board milling technology used, which also sets its own requirements. Because our lab has a decent circuit board milling machine, LPKF ProtoMat S62, I decided to use it to achieve a better end result and my requirements, and I didn’t even try to use generic milling machine according to Fab Academy processes. Our milling machine generally uses a 0.2-0.5mm V-bit, based on which I selected 0.2mm clearance and 0.25mm track witdh. For the operating current tracks, I used a slightly bigger witdh. </p>
<table>
<thead>
<tr>
<th><img alt="" src="../../images/week08/kicad_schematic.resized.png" /></th>
</tr>
</thead>
<tbody>
<tr>
<td>KiCad Schematic</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><img alt="" src="../../images/week08/netclasses.resized.png" /></th>
</tr>
</thead>
<tbody>
<tr>
<td>KiCad Net Classes</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><img alt="" src="../../images/week08/kicad_pcb.resized.png" /></th>
</tr>
</thead>
<tbody>
<tr>
<td>KiCad PCB</td>
</tr>
</tbody>
</table>
<p>The ESP32 data sheet set some requirements such as operating voltage and minimum current ​​as well as programming interface connections. The ESP32 requirement for operating current is 3.3V and at least 500mA. There were only 100mA and 1A regulators on the Fab Lab shelf so I used a 1A regulator. Other components required for power supply were found in the regulator data sheet. The reset and programming button connections with their peripherals are found from the ESP32 data sheet. </p>
<h2 id="circuit-board-assembly">Circuit board assembly</h2>
<p>Assembling the circuit board succeeded without major problems. ESP32 <a href="https://www.espressif.com/en/products/modules">WROOM-32E</a>, the module I used, was a little difficult to solder because the legs in it were like a 90-degree angle to the surface of the circuit board. Luckily, I had a <a href="https://www.quadhands.com/products/quadhands-jumbo-workbench">QuadHands Jumbo Workbench</a> in my home lab with which I got the circuit board at a suitable angle so that the soldering could be done with ease. </p>
<table>
<thead>
<tr>
<th><img alt="" src="../../images/week08/pcb.resized.jpg" /></th>
</tr>
</thead>
<tbody>
<tr>
<td>Milled PCB</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><img alt="" src="../../images/week08/soldering.resized.jpg" /></th>
</tr>
</thead>
<tbody>
<tr>
<td>Component assembly</td>
</tr>
</tbody>
</table>
<p>Schematic had 4.7uF capacitors in the regulator input and output as instructed by the regulator data sheet, but since there were no parts of that size on the shelf, I replaced them with 10uF when I assembled the circuit board. </p>
<h2 id="circuit-board-testing">Circuit board testing</h2>
<p>After assembly, I did basic tests with a multimeter for possible short circuits. </p>
<p>My USB serial port uses 5V voltages, so I started thinking if it would be safe to use due to too high a voltages. There was no concern with the operating voltage (Vcc) because the circuit board has a 3.3V regulator but the voltages on the TX/RX lines caused concern. There is no mention in the ESP32 data sheet whether those pins are 5V tolerant or not, so I had to find out if it is safe to plug TX/RX with that high voltage. Searching the internet I found information that all ESP32 digital I/O pins are 5V tolerant, although this is not explicitly mentioned in the data sheet. </p>
<p>I connected USB serial port adapter to PCB normally, TX, RX, Vcc, GND. I checked the functionality of my board by trying to read the chip id with esptool. After a few attempts, it worked so I knew the circuit would work. Here I had to press the BOOT and EN buttons I had installed on the circuit board a few times. At the same time, it was found that the chip enters programming mode when you hold down the BOOT button and resets the ESP32 with the EN button or by turning on the power. </p>
<pre><code class="language-console">$ esptool --chip esp32 chip_id
esptool.py v2.8
Found 1 serial ports
Serial port /dev/ttyUSB0
Connecting.....
Chip is ESP32D0WDQ6 (revision 1)
Features: WiFi, BT, Dual Core, 240MHz, VRef calibration in efuse, Coding Scheme None
Crystal is 40MHz
MAC: 24:6f:28:86:31:4c
Uploading stub...
Running stub...
Stub running...
Warning: ESP32 has no Chip ID. Reading MAC instead.
MAC: 24:6f:28:86:31:4c
Hard resetting via RTS pin...
$
</code></pre>
<h2 id="temperature-sensors">Temperature sensors</h2>
<p>Since my final project is a weather station I decided to use temperature sensors as input devices. I installed two different temperature sensors, a <a href="http://www.aosong.com/en/products-21.html">Aosong Electronics DHT11</a> and a 10k NTC thermistor (<a href="https://www.amphenol-sensors.com/en/thermometrics/ntc-thermistors/smd/951-smd">Amphenol Advanced Sensors NHQ103B375T10</a>). The DHT11 was a ready-made module with one data line in addition to the operating power interface. NTC thermistor is connected using simple voltage divider circuit to the ESP32 ADC converter. </p>
<table>
<thead>
<tr>
<th><img alt="" src="../../images/week08/ntc_voltage_divider.resized.png" /></th>
</tr>
</thead>
<tbody>
<tr>
<td>NTC thermistor voltage divider</td>
</tr>
</tbody>
</table>
<p>I installed a DHT11 sensor on the IO26 pin and an NTC thermistor circuit on the IO4 pin which has the ADC converter. </p>
<p>I decided to test the temperature sensors with a small snippet of code. For code development, I used Arduino where I installed ESP32 support with the Board Manager at: <a href="https://dl.espressif.com/dl/package_esp32_index.json">https://dl.espressif.com/dl/package_esp32_index.json</a>.</p>
<p>From Arduino IDE I selected board:
Tools -&gt; Board -&gt; ESP32 Arduino -&gt; ESP32 Dev Module</p>
<p>For the DHT11 sensor, many libraries were found in the Arduino Library Manager, from which I installed the <a href="https://www.arduino.cc/reference/en/libraries/dht-sensor-library-for-espx/">"DHT sensor library for ESPx"</a>. </p>
<p>I quickly tested the operation of the sensor with an example program coming with the library and it worked right away. </p>
<p>However, I still had that another sensor circuit based on NTC thermistor so I started to study the operation of the ADC converter. I read the values ​​of the ADC converter from the microcontroller with the analogRead() function and examined them. The values ​​returned by the function changed when I heated the thermistor with my finger, so it worked more or less, although the read values ​​seemed to be a little lower than expected. I assumed that the ADC converter returns values ​​0-4095 (12-bit resolution) linearly depending on the voltage 0-3.3V connected to the pin. After researching for a while, I realized that there are quite a few configurable things in the ESP32 ADC converter, of which the analogSetAttenuation() function seemed to be quite significant. I connected the adjustable voltage source to the ADC converter and tested using different voltages what kind of values ADC returns. I measured the following maximum possible voltages for each attenuation configuration. </p>
<table>
<thead>
<tr>
<th>analogSetAttenuation()</th>
<th>max voltage measured</th>
</tr>
</thead>
<tbody>
<tr>
<td>ADC_0db</td>
<td>1.0V</td>
</tr>
<tr>
<td>ADC_2_5db</td>
<td>1.3V</td>
</tr>
<tr>
<td>ADC_6db</td>
<td>1.9V</td>
</tr>
<tr>
<td>ADC_11db</td>
<td>3.1V</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><img alt="" src="../../images/week08/adc_test.resized.jpg" /></th>
</tr>
</thead>
<tbody>
<tr>
<td>ADC testing</td>
</tr>
</tbody>
</table>
<p>Judging from the values, it seems that the ADC of the circuit reads a maximum voltage of 1V, but attenuators are connected in front of the ADC converter, which can increase the value range of the input. Still, those readings and attenuations didn’t really open up for me, but at this point I couldn’t get to know the matter further. Since when heating the NTC with the ADC_6db setting, it still saturates the ADC converter, I used the ADC_11db setting and scaled the values ​​to the measured 3.1V voltage so that I got about the correct values. That was enough at this point. </p>
<p>I was able to read the values ​​from the device via the serial port as text and graphs with the Arduino serial plotter function. </p>
<table>
<thead>
<tr>
<th><img alt="" src="../../images/week08/arduino.resized.png" /></th>
</tr>
</thead>
<tbody>
<tr>
<td>Arduino temperature sensor graphs</td>
</tr>
</tbody>
</table>
<p>The graph shows how the values ​​given by the sensors change as they are heated. I used a hot air gun so the highest readings should probably be somewhere near 80 degrees Celsius. </p>
<pre><code class="language-c">#include &quot;DHTesp.h&quot;

DHTesp dht11;

void setup() {
  Serial.begin(115200);
  Serial.println(&quot;Temperature test, input week&quot;);

//  analogSetAttenuation(ADC_0db);    // 1.0V max measured
//  analogSetAttenuation(ADC_2_5db);  // 1.3V max measured
//  analogSetAttenuation(ADC_6db);    // 1.9V max measured
  analogSetAttenuation(ADC_11db);   // 3.1V max measured

  // Initialize DHT11 temperature sensor, IO26
  dht11.setup(26, DHTesp::DHT11);
}

void loop() {
  // ESP32 default ADC resolution is 12 bits, values 0 - 4095.
  // If we assume curve is linear and all the other are correct then ADC value 0 is 0V
  // and value 4095 is 3.3V =&gt; analogRead() / 4095 * 3.3 = voltage on pin. Only in theory.
  // It is not that simple, see analogSetAttenuation()...

  // Read 10k NTC thermistor on IO4. It is connected as voltage divider, so at 25C it should be 0.5 * 3.3V = 1.65V
  unsigned int AdcValue = analogRead(4);

  // Get DHT11 data
  TempAndHumidity sensorData;
  sensorData = dht11.getTempAndHumidity();

  // Output is scaled somehow weird in order to plot it using Arduino Serial Plotter
  Serial.println(&quot;DHT11_Temperature:&quot; + String(sensorData.temperature, 2) + &quot; DHT11_Humidity:&quot; + String(sensorData.humidity, 1)
                 + &quot; NTC_analogRead/100:&quot; + String(AdcValue/100.0) + &quot; NTC_Voltagex10:&quot; + String(3.1/4095 * AdcValue * 10));

  sleep(2);
}
</code></pre>
<h2 id="oscilloscope-exercise">Oscilloscope exercise</h2>
<p>I used an oscilloscope to measure the digital signal from the DHT11 sensor data line and the analog signal from the NTC thermistor circuit. I used <a href="https://www.lab-nation.com/">LabNation SmartScope</a> for measurements, which is a small oscilloscope with a USB connection. </p>
<table>
<thead>
<tr>
<th><img alt="" src="../../images/week08/osc_a.resized.jpg" /></th>
</tr>
</thead>
<tbody>
<tr>
<td>Measurement setup</td>
</tr>
</tbody>
</table>
<h3 id="ntc-thermistor-circuit">NTC thermistor circuit</h3>
<table>
<thead>
<tr>
<th><img alt="" src="../../images/week08/osc_b.resized.jpg" /></th>
</tr>
</thead>
<tbody>
<tr>
<td>NTC thermistor circuit DUT</td>
</tr>
</tbody>
</table>
<p>The voltage change from the NTC thermistor is not very interesting to measure with an oscilloscope, but I still got some curves - at least you can see how quickly it reacts to the temperature change. In this measurement I also used hot air gun. At 1m40, the graph shows how the voltage has risen to about 3.3V. From this it can be concluded that it is likely that the ADC is saturated and thus no actual temperature has been transmitted to the program, i.e. the voltage distribution used would not work for very high temperatures - maybe the same will happen for cold temperatures? </p>
<table>
<thead>
<tr>
<th><img alt="" src="../../images/week08/ntc.resized.png" /></th>
</tr>
</thead>
<tbody>
<tr>
<td>NTC thermistor measurement</td>
</tr>
</tbody>
</table>
<h3 id="dht11-sensor">DHT11 sensor</h3>
<table>
<thead>
<tr>
<th><img alt="" src="../../images/week08/osc_c.resized.jpg" /></th>
</tr>
</thead>
<tbody>
<tr>
<td>DHT11 DUT</td>
</tr>
</tbody>
</table>
<p>The DHT11 measurement was a bit more interesting. I connected the oscilloscope to the data line of the DHT11 module, turned on the oscilloscope "single trigger" and let it take one sample of the sensor. The measurement shows that the bus is in idle state HIGH. The host (ESP32) then pulls the bus down for about 18ms, asking the sensor to deliver the measurement result. The sensor responds with a data burst of 4ms or less. In the burst, there is a space between each symbol in LOW mode about 52us. Bit value 0 is 25us HIGH, bit value 1 is 70us - assuming there is more zeros than the ones in the payload. </p>
<table>
<thead>
<tr>
<th><img alt="" src="../../images/week08/dht11_a.resized.png" /></th>
</tr>
</thead>
<tbody>
<tr>
<td>Captured measurement, whole sequence</td>
</tr>
</tbody>
</table>
<p>My oscilloscope has some protocol decoders like I2C and 1-wire, but none of those were able to decode data. I used "Edge intervals" decoder for both rising and falling edges in order to get timing calculated. That decoder produced something visual (color bars) that can be read somehow rather easily. Payload on that sample seems to be 41 bit long "0010000000000000000110010000001100111100". That bit string has temperature and humidity information encoded either in analog sensor values ​​or even as precalculated temperature degrees and humidity percentages. </p>
<table>
<thead>
<tr>
<th><img alt="" src="../../images/week08/dht11_d.resized.png" /></th>
</tr>
</thead>
<tbody>
<tr>
<td>Sensor data. 0010000000000000000110010000001100111100, 41bits.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><img alt="" src="../../images/week08/dht11_b.resized.png" /></th>
</tr>
</thead>
<tbody>
<tr>
<td>Start marker. Around 15us HIGH + 85us LOW + 85us HIGH</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><img alt="" src="../../images/week08/dht11_c.resized.png" /></th>
</tr>
</thead>
<tbody>
<tr>
<td>Space between each symbol. LOW around 52us. That translates to 0b010.</td>
</tr>
</tbody>
</table>
<h2 id="references">References</h2>
<ul>
<li><a href="https://www.espressif.com/en/products/socs/esp32">Espressif ESP32</a></li>
<li><a href="http://www.aosong.com/en/products-21.html">Aosong Electronics DHT11</a></li>
<li><a href="https://www.amphenol-sensors.com/en/thermometrics/ntc-thermistors/smd/951-smd">Amphenol Advanced Sensors NHQ103B375T10</a></li>
<li><a href="https://www.lab-nation.com/">LabNation SmartScope</a></li>
</ul>
<h2 id="files">Files</h2>
<ul>
<li><a href="../../images/week08/Esp32.zip">Esp32.zip</a></li>
<li><a href="../../images/week08/input_test.ino">input_test.ino</a></li>
</ul>
<h2 id="final-thoughts">Final thoughts</h2>
<p>I didn't learn almost anything this week, but used too much time for making this documentation. </p>




              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../week07/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 7. Electronics design" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              7. Electronics design
            </div>
          </div>
        </a>
      
      
        
        <a href="../week09/" class="md-footer__link md-footer__link--next" aria-label="Next: 9. Output devices" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              9. Output devices
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.9c69f0bc.min.js"></script>
      
    
  </body>
</html>